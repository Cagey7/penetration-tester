import sys
import re
import socket

def main():
    if len(sys.argv) == 1:
        usage()

    if sys.argv[1] == "-cp" or sys.argv[1] == "--check-port":
        if len(sys.argv) != 4:
            check_port_usage()
        else:
            if not (is_valid_ipv4(sys.argv[2]) or is_valid_domain(sys.argv[2])):
                print("Invalid IP or host")
                check_port_usage()
            try:
                if int(sys.argv[3]) not in range(1, 65536):
                    print("Invalid port")
                    check_port_usage()
            except ValueError:
                print("Invalid port")
                check_port_usage()
        port_scan(sys.argv[2], int(sys.argv[3]))
    else:
        usage()


def check_port_usage():
    print("Usage for check ports:")
    print("  python pentest.py [option] [host] [port]")
    print("Options:")
    print("  -cp, --check-port       Checks port")
    print("Example:")
    print("  python pentest.py --check-port example.com 443")
    exit()


def is_valid_ipv4(ip):
    pattern = r'^((25[0-5]|2[0-4]\d|[01]?\d{1,2})\.){3}(25[0-5]|2[0-4]\d|[01]?\d{1,2})$'
    if re.match(pattern, ip):
        return True
    return False


def is_valid_domain(domain):
    pattern = r'^[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z]{2,}$'
    if re.match(pattern, domain):
        return True
    return False


def usage():
    print("Usage:")
    exit()

def port_scan(host, port):
    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    sock.settimeout(1)
    if sock.connect_ex((host, port)):
        print(f"Port [{port}] on [{host}] is down!")
    else:
        print(f"Port [{port}] on [{host}] is up!")

if __name__ == "__main__":
    main()